{"version":3,"sources":["../../../../server/api/registry/registry.controller.js"],"names":[],"mappings":"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","file":"registry.controller.js","sourcesContent":["'use strict';\n\nvar _ = require('lodash');\nvar Registry = require('./registry.model').registry;\nvar RegistryProduct = require('./registry.model').registryProduct;\n\n\n\nfunction isJson(str) {\n\ttry {\n\t\tstr = JSON.parse(str);\n\t} catch (e) {\n\t\tstr = str;\n\t}\n\treturn str\n}\n\n\nfunction handleError(res, statusCode) {\n  statusCode = statusCode || 500;\n  return function(err) {\n    console.error(err, statusCode);\n    res.status(statusCode).send(err);\n  };\n}\n\nfunction responseWithResult(res, statusCode) {\n\t\n  statusCode = statusCode || 200;\n  return function(entity) {\n    if (entity) {\n    \tconsole.log(\"inside entity\")\n    \t\n\t\tres.end(JSON.stringify(entity));\n      \n    }\n  };\n}\n\n// Get all features group\nexports.count = function(req, res) {\n\t\n\tif(req.query){\n\t\tvar q = isJson(req.query.where);\n\t\tWishlist.find(q).count().exec(function (err, count) {\n\t\t\tif(err) { \n\t\t\t\tconsole.log(err)\n\t\t\t\treturn handleError(res, err); }\n\t\t\t\treturn res.status(200).json([{count:count}]);\n\t\t\t});\n\t}\n};\n\n// Get list of products\nexports.index = function(req, res) {\n\tif(req.query){\n\n\t\tif(req.query.count){\n\t\t\t\n\t\t\tvar q = isJson(req.query.count);\n\t\t\t\t\t\t\n\t\t\tRegistry.find(q).select('_id occasion').exec(function (err, registries) {\n\t\t\t\tif(err) { \n\t\t\t\t\tconsole.log(err)\n\t\t\t\t\treturn handleError(res, err); }\n\t\t\t\t\t\n\t\t\t\t\treturn res.status(200).json(registries);\n\t\t\t\t});\n\t\t}\n\t\telse{\n\t\t\t\n\t\t\tvar q = isJson(req.query.where);\n\t\t\t//console.log(q);\n\t\t\tRegistry.find(q).exec(function (err, registry) {\n\t\t\t\tif(err) { console.log(err);\n\t\t\t\t\treturn handleError(res, err); }\n\t\t\t\t\t\n\t\t\t\t\treturn res.status(200).json(registry);\n\t\t\t\t});\n\t\t}\n\n\n\n\t}else{\n\t\tRegistry.find(function (err, registry) {\n\t\t\tif(err) { return handleError(res, err); }\n\t\t\treturn res.status(200).json(registry);\n\t\t});\n\t}\n};\n\n\n\n// Get a single product\nexports.show = function(req, res) {\n  Registry.findOne({\n      _id: req.params.id\n    })\n    .populate('product')\n    \n    .exec()\n    .then(handleEntityNotFound(res))\n    .then(function(entity) {\n      if (entity) {\n      \tconsole.log(entity)\n      \tconsole.log(\"inside then\")\n        res.status(200).json(entity);\n      }\n    })\n    .catch(handleError(res));\n};\n\n// Creates a new product in the DB.\n/*exports.create = function(req, res) {\n\tconsole.log(req.body)\n  Registry.createAsync(req.body)\n    .then(responseWithResult(res, 201))\n    .catch(handleError(res));\n};*/\n\nexports.create = function(req, res) {\n\t\n\tRegistry.create(req.body, function(err, registry) {\n\t\tif(err) { return handleError(res, err); }\n\t\t\n\t\treturn res.status(201).json(registry);\n\t});\n};\n\nexports.createregistryProduct = function(req, res) {\n\t\n\t/*RegistryProduct.create(req.body, function(err, registry) {\n\t\tif(err) { return handleError(res, err); }\n\t\t\n\t\treturn res.status(201).json(registry);\n\t});*/\n/*\n\tRegistryProduct.createAsync(req.body)\n    .then(linkRegistryProduct(res, req.params.id))\n    .then(responseWithResult(res, 201))\n    .catch(handleError(res));*/\n\n    Registry.findByIdAsync(req.params.id)\n      .then(handleEntityNotFound(res))\n      .then(function(entity) {\n        entity.products.push(req.body);\n        return entity.save(function (err) {\n                    if (err) { return handleError(res, err); }\n                     return res.status(200).json(entity);\n                  });\n      })\n};\n\n\nfunction linkRegistryProduct(res, registryId) {\n  return function(entity) {\n    var product = entity;\n    console.log(\"inside link registry\")\n    console.log(registryId)\n    return Registry.findByIdAsync(registryId)\n      .then(handleEntityNotFound(res))\n      .then(function(entity) {\n        entity.products.push(product._id);\n        return entity.saveAsync().spread(function() {\n          return product;\n        });\n      })\n  }\n}\n\nfunction handleEntityNotFound(res) {\n  return function(entity) {\n    if (!entity) {\n      res.status(404).end();\n      return null;\n    }\n    return entity;\n  };\n}\n// Updates an existing product in the DB.\nexports.update = function(req, res) {\n\tif(req.body._id) { delete req.body._id; }\n // req.body.uid = req.user.email; // id change on every login hence email is used\n req.body.updated = Date.now();\n if(req.body.name)\n \treq.body.nameLower = req.body.name.toString().toLowerCase();\n if(!req.body.slug && req.body.name)\n \treq.body.slug = req.body.name.toString().toLowerCase()\n                      .replace(/\\s+/g, '-')        // Replace spaces with -\n                      .replace(/[^\\w\\-]+/g, '')   // Remove all non-word chars\n                      .replace(/\\-\\-+/g, '-')      // Replace multiple - with single -\n                      .replace(/^-+/, '')          // Trim - from start of text\n                      .replace(/-+$/, '');\n\n                      Registry.findById(req.params.id, function (err, registry) {\n                      \tif (err) { return handleError(res, err); }\n                      \tif(!registry) { return res.status(404).send('Not Found'); }\n                      \t\n                      \tvar updated = _.extend(registry, req.body);\n                      \t//console.log(updated);\n                      \tupdated.save(function (err) {\n                      \t\tif (err) { return handleError(res, err); }\n                      \t\treturn res.status(200).json(registry);\n                      \t});\n                      });\n                  };\n\n// Deletes a product from the DB.\nexports.destroy = function(req, res) {\n\tRegistry.findById(req.params.id, function (err, product) {\n\t\tif(err) { return handleError(res, err); }\n\t\tif(!product) { return res.status(404).send('Not Found'); }\n\t\tproduct.remove(function(err) {\n\t\t\tif(err) { return handleError(res, err); }\n\t\t\treturn res.status(204).send('No Content');\n\t\t});\n\t});\n};\n\n\n\nfunction handleError(res, err) {\n\treturn res.status(500).send(err);\n}\n\n\n\n\n\n"]}