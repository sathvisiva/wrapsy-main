{"version":3,"sources":["../../../../server/api/product/product.controller.js"],"names":[],"mappings":";;;;;;;;;AASC,YAAY,CAAC;;;;AAEb,IAAI,CAAC,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;;AAG1B,IAAI,OAAO,GAAG,OAAO,CAAC,iBAAiB,CAAC,CAAC,OAAO,CAAC;AACjD,IAAI,KAAK,GAAG,OAAO,CAAC,iBAAiB,CAAC,CAAC,KAAK,CAAC;AAC7C,IAAI,MAAM,GAAG,OAAO,CAAC,iBAAiB,CAAC,CAAC,MAAM,CAAC;AAC/C,IAAI,OAAO,GAAG,OAAO,CAAC,iBAAiB,CAAC,CAAC,OAAO,CAAC;AACjD,IAAI,MAAM,GAAG,OAAO,CAAC,iBAAiB,CAAC,CAAC,MAAM,CAAC;AAC/C,IAAI,OAAO,GAAG,OAAO,CAAC,0BAA0B,CAAC,CAAC;AAClD,IAAI,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC;;AAI3B,SAAS,WAAW,CAAC,GAAG,EAAE,UAAU,EAAE;AACrC,YAAU,GAAG,UAAU,IAAI,GAAG,CAAC;AAC/B,SAAO,UAAS,GAAG,EAAE;AACnB,WAAO,CAAC,KAAK,CAAC,GAAG,EAAE,UAAU,CAAC,CAAC;AAC/B,OAAG,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;GAClC,CAAC;CACH;;AAED,SAAS,MAAM,CAAC,GAAG,EAAE;AACnB,MAAI;AACF,OAAG,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;GACvB,CAAC,OAAO,CAAC,EAAE;AACV,OAAG,GAAG,GAAG,CAAC;GACX;AACD,SAAO,GAAG,CAAA;CACX;;AAED,SAAS,kBAAkB,CAAC,GAAG,EAAE,UAAU,EAAE;;AAG3C,YAAU,GAAG,UAAU,IAAI,GAAG,CAAC;AAC/B,SAAO,UAAS,MAAM,EAAE;AACtB,QAAI,MAAM,EAAE;AACV,SAAG,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;KACrC;GACF,CAAC;CACH;;AAED,SAAS,oBAAoB,CAAC,GAAG,EAAE;AACjC,SAAO,UAAS,MAAM,EAAE;AACtB,QAAI,CAAC,MAAM,EAAE;AACX,SAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,CAAC;AACtB,aAAO,IAAI,CAAC;KACb;AACD,WAAO,MAAM,CAAC;GACf,CAAC;CACH;;AAED,SAAS,WAAW,CAAC,OAAO,EAAE;AAC5B,SAAO,UAAS,MAAM,EAAE;AACtB,QAAI,OAAO,GAAG,CAAC,CAAC,KAAK,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC;AACvC,WAAO,OAAO,CAAC,SAAS,EAAE,CACzB,MAAM,CAAC,UAAS,OAAO,EAAE;AACxB,aAAO,OAAO,CAAC;KAChB,CAAC,CAAC;GACJ,CAAC;CACH;;AAED,SAAS,YAAY,CAAC,GAAG,EAAE;AACzB,SAAO,UAAS,MAAM,EAAE;AACtB,QAAI,MAAM,EAAE;AACV,aAAO,MAAM,CAAC,WAAW,EAAE,CAC1B,IAAI,CAAC,YAAW;AACf,WAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,CAAC;OACvB,CAAC,CAAC;KACJ;GACF,CAAC;CACH;;AAED,SAAS,iBAAiB,CAAC,GAAG,EAAE,IAAI,EAAE;AACpC,SAAO,UAAS,MAAM,EAAE;AACtB,QAAI,OAAO,GAAG,kBAAkB,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AAC5D,UAAM,CAAC,QAAQ,GAAG,OAAO,CAAC;AAC1B,WAAO,MAAM,CAAC,SAAS,EAAE,CAAC,MAAM,CAAC,UAAS,OAAO,EAAE;AACjD,aAAO,OAAO,CAAC;KAChB,CAAC,CAAC;GACJ,CAAA;CACF;;AAED,SAAS,kBAAkB,CAAC,KAAK,EAAC,IAAI,EAAE;AACtC,OAAK,GAAG,MAAM,CAAC,KAAK,CAAC,IAAI,IAAI,CAAC;AAC9B,SAAO,UAAS,OAAO,EAAE;AACvB,QAAI,WAAW,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;AACzD,WAAO,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;AACzB,WAAO,OAAO,CACb,IAAI,CAAC;AACJ,kBAAY,EAAE;AACZ,WAAG,EAAE,WAAW;OACjB;KACF,CAAC,CACD,IAAI,CAAC,IAAI,GAAC,KAAK,CAAC,CAChB,KAAK,CAAC,KAAK,CAAC,CACZ,IAAI,CAAC,EAAC,KAAK,EAAE,KAAK,EAAC,CAAC,CACpB,QAAQ,CAAC,EAAE,IAAI,EAAE,YAAY,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC,CAChD,QAAQ,CAAC,EAAE,IAAI,EAAE,SAAS,EAAE,MAAM,EAAE,QAAQ,EAAE,CAAC,CAC/C,QAAQ,CAAC,EAAE,IAAI,EAAE,QAAQ,EAAE,MAAM,EAAE,UAAU,EAAE,CAAC,CAChD,QAAQ,CAAC,EAAE,IAAI,EAAE,UAAU,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC,CAC9C,SAAS,EAAE,CAAC;GACd,CAAA;CACF;;AAED,SAAS,wBAAwB,CAAC,IAAI,EAAE;AACtC,SAAO,UAAS,OAAO,EAAE;AACvB,QAAI,WAAW,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;AACzD,QAAI,MAAM,CAAC;;AAEX,QAAI,OAAO,CAAC,IAAI,IAAI,KAAK,EACvB,MAAM,GAAG;AACP,WAAK,EAAE;AACL,eAAO,EAAE,IAAI;OACd;KACF,CAAC,KAEA,MAAM,GAAG;AACP,kBAAY,EAAE;AACZ,WAAG,EAAE,WAAW;OACjB;AACD,WAAK,EAAE;AACL,eAAO,EAAE,IAAI;OACd;KACF,CAAC;;AAEF,WAAO,OAAO,CACb,IAAI,CAAC,MAAM,CAAC,CACZ,QAAQ,CAAC,EAAE,IAAI,EAAE,YAAY,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC,CAChD,QAAQ,CAAC,EAAE,IAAI,EAAE,SAAS,EAAE,MAAM,EAAE,QAAQ,EAAE,CAAC,CAC/C,QAAQ,CAAC,EAAE,IAAI,EAAE,QAAQ,EAAE,MAAM,EAAE,UAAU,EAAE,CAAC,CAChD,SAAS,EAAE,CAAC;GACd,CAAA;CACF;;;AAGL,OAAO,CAAC,KAAK,GAAG,UAAS,GAAG,EAAE,GAAG,EAAE;AACjC,MAAG,GAAG,CAAC,KAAK,EAAC;AACX,QAAI,CAAC,GAAG,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;AAChC,QAAI,KAAK,GAAG,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;AACrC,QAAI,IAAI,GAAG,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,CAAA;;AAEnC,WAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;AACnB,WAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,QAAQ,CAAC,EAAE,IAAI,EAAE,YAAY,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC,CAAC,SAAS,EAAE,CACnG,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC,SACxB,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;GAE1B,MAAI;AACH,WAAO,CAAC,IAAI,EAAE,CAAC,IAAI,CAAC,EAAE,QAAQ,EAAE,CAAC,EAAE,CAAC,CAAC,QAAQ,CAAC,EAAE,IAAI,EAAE,YAAY,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC,CAAC,SAAS,EAAE,CAChG,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC,SACxB,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;GAC1B;CACF,CAAC;;AAGF,OAAO,CAAC,YAAY,GAAG,UAAS,GAAG,EAAE,GAAG,EAAC;AACxC,MAAG,GAAG,CAAC,KAAK,EAAC;AACZ,WAAO,CAAC,GAAG,CAAC,GAAG,CAAC,KAAK,CAAC,CAAA;AACtB,QAAI,CAAC,GAAG,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;AAChC,WAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,QAAQ,CAAC,EAAE,IAAI,EAAE,YAAY,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC,CAAC,SAAS,EAAE,CACvH,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC,SACxB,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;GAE1B;CACA,CAAA;;AAED,OAAO,CAAC,qBAAqB,GAAG,UAAS,GAAG,EAAC,GAAG,EAAC;AAChD,SAAO,CAAC,MAAM,CAAC,EAAE,GAAG,EAAE,GAAG,CAAC,MAAM,CAAC,EAAE,EAAE,EAAE,EAAE,IAAI,EAAE,EAAE,QAAQ,EAAE,IAAI,EAAE,EAAC,EAAE,UAAU,GAAG,EAAE,OAAO,EAAE;AAC3F,QAAI,GAAG,EAAE;AACP,oBAAc,CAAC,GAAG,GAAG,GAAG,CAAC;AACzB,oBAAc,CAAC,IAAI,GAAG,IAAI,CAAC;AAC3B,oBAAc,CAAC,IAAI,GAAG,GAAG,CAAC;;AAE1B,aAAO,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;KACjC;AACD,WAAO,CAAC,IAAI,EAAE,CAAC,IAAI,CAAC,EAAE,QAAQ,EAAE,CAAC,EAAE,CAAC,CAAC,QAAQ,CAAC,EAAE,IAAI,EAAE,YAAY,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC,CAAC,SAAS,EAAE,CAChG,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC,SACxB,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;GAE1B,CAAC,CAAC;CACF,CAAA;;AAED,OAAO,CAAC,0BAA0B,GAAG,UAAS,GAAG,EAAC,GAAG,EAAC;AACrD,SAAO,CAAC,MAAM,CAAC,EAAE,GAAG,EAAE,GAAG,CAAC,MAAM,CAAC,EAAE,EAAE,EAAE,EAAE,IAAI,EAAE,EAAE,QAAQ,EAAE,KAAK,EAAE,EAAC,EAAE,UAAU,GAAG,EAAE,OAAO,EAAE;AAC5F,QAAI,GAAG,EAAE;AACP,oBAAc,CAAC,GAAG,GAAG,GAAG,CAAC;AACzB,oBAAc,CAAC,IAAI,GAAG,IAAI,CAAC;AAC3B,oBAAc,CAAC,IAAI,GAAG,GAAG,CAAC;;AAE1B,aAAO,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;KACjC;AACD,WAAO,CAAC,IAAI,EAAE,CAAC,IAAI,CAAC,EAAE,QAAQ,EAAE,CAAC,EAAE,CAAC,CAAC,QAAQ,CAAC,EAAE,IAAI,EAAE,YAAY,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC,CAAC,SAAS,EAAE,CAChG,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC,SACxB,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;GAE1B,CAAC,CAAC;CACF,CAAA;;AAED,OAAO,CAAC,qBAAqB,GAAG,UAAS,GAAG,EAAE,GAAG,EAAC;AAChD,SAAO,CAAC,IAAI,CAAC,EAAC,SAAS,EAAC,IAAI,EAAC,CAAC,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,CAAC,CAAC,QAAQ,CAAC,EAAE,IAAI,EAAE,YAAY,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC,CAAC,SAAS,EAAE,CAC7G,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC,SACxB,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;CAC1B,CAAA;;AAED,OAAO,CAAC,aAAa,GAAG,UAAS,GAAG,EAAE,GAAG,EAAE;AACzC,SAAO,CAAC,IAAI,EAAE,CAAC,SAAS,EAAE,CACzB,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC,SACxB,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;CAC1B,CAAC;;AAEF,OAAO,CAAC,YAAY,GAAG,UAAS,GAAG,EAAE,GAAG,EAAE;AACxC,QAAM,CAAC,IAAI,EAAE,CAAC,SAAS,EAAE,CACxB,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC,SACxB,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;CAC1B,CAAC;;AAEF,OAAO,CAAC,KAAK,GAAG,UAAS,GAAG,EAAE,GAAG,EAAE;;AAEjC,SAAO,CAAC,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;;AAEtB,MAAG,GAAG,CAAC,IAAI,EAAC;;AAEV,QAAI,CAAC,GAAG,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;AAC/B,WAAO,CAAC,GAAG,CAAC,GAAG,GAAC,CAAC,CAAC,CAAA;;AAElB,WAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC,IAAI,CAAC,UAAU,GAAG,EAAE,KAAK,EAAE;AACjD,aAAO,CAAC,GAAG,CAAC,OAAO,GAAG,KAAK,CAAC,CAAC;AAC7B,UAAG,GAAG,EAAE;AACN,eAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAA;AAChB,eAAO,WAAW,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;OAAE;AAC/B,aAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,EAAC,KAAK,EAAC,KAAK,EAAC,CAAC,CAAC,CAAC;KAC9C,CAAC,CAAC;GACN,MAAI;AACH,WAAO,CAAC,KAAK,EAAE,CAAC,IAAI,CAAC,UAAU,GAAG,EAAE,KAAK,EAAE;AACzC,UAAG,GAAG,EAAE;AACN,eAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAA;AAChB,eAAO,WAAW,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;OAAE;AAC/B,aAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,EAAC,KAAK,EAAC,KAAK,EAAC,CAAC,CAAC,CAAC;KAC9C,CAAC,CAAC;GACN;CACF,CAAC;;AAEF,OAAO,CAAC,IAAI,GAAG,UAAS,GAAG,EAAE,GAAG,EAAE;AAChC,SAAO,CAAC,OAAO,CAAC;AACd,QAAI,EAAE,GAAG,CAAC,MAAM,CAAC,IAAI;GACtB,CAAC,CACD,QAAQ,CAAC,QAAQ,CAAC,CAClB,QAAQ,CAAC,EAAE,IAAI,EAAE,SAAS,EAAE,CAAC,CAAC,QAAQ,CAAC,EAAE,IAAI,EAAE,YAAY,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC,CAC9E,SAAS,EAAE,CACX,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC,CAC/B,IAAI,CAAC,UAAS,MAAM,EAAE;AACrB,QAAI,MAAM,EAAE;AACV,SAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;KAC9B;GACF,CAAC,SACI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;CAC1B,CAAC;;;AAGF,OAAO,CAAC,MAAM,GAAG,UAAS,GAAG,EAAE,GAAG,EAAE;AAClC,SAAO,CAAC,WAAW,CAAC,GAAG,CAAC,IAAI,CAAC,CAC5B,IAAI,CAAC,kBAAkB,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC,SAC7B,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;CAC1B,CAAC;;AAEF,OAAO,CAAC,aAAa,GAAG,UAAS,GAAG,EAAE,GAAG,EAAE;AACzC,SAAO,CAAC,GAAG,CAAC,uBAAuB,CAAC,CAAC;AACrC,SAAO,CAAC,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;AACtB,SAAO,CAAC,WAAW,CAAC,GAAG,CAAC,IAAI,CAAC,CAC5B,IAAI,CAAC,kBAAkB,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC,SAC7B,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;CAC1B,CAAC;;AAEF,OAAO,CAAC,YAAY,GAAG,UAAS,GAAG,EAAE,GAAG,EAAE;AACxC,SAAO,CAAC,GAAG,CAAC,4BAA4B,CAAC,CAAC;AAC1C,SAAO,CAAC,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;AACtB,QAAM,CAAC,WAAW,CAAC,GAAG,CAAC,IAAI,CAAC,CAC3B,IAAI,CAAC,kBAAkB,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC,SAC7B,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;CAC1B,CAAC;;;AAGF,OAAO,CAAC,MAAM,GAAG,UAAS,GAAG,EAAE,GAAG,EAAE;AAClC,MAAI,GAAG,CAAC,IAAI,CAAC,GAAG,EAAE;AAChB,WAAO,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC;GACrB;AACD,SAAO,CAAC,aAAa,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CACnC,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC,CAC/B,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAC3B,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC,SACxB,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;CAC1B,CAAC;;AAEF,OAAO,CAAC,aAAa,GAAG,UAAS,GAAG,EAAE,GAAG,EAAE;AACzC,MAAI,GAAG,CAAC,IAAI,CAAC,GAAG,EAAE;AAChB,WAAO,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC;GACrB;AACD,SAAO,CAAC,aAAa,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CACnC,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC,CAC/B,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAC3B,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC,SACxB,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;CAC1B,CAAC;;;AAGF,OAAO,CAAC,OAAO,GAAG,UAAS,GAAG,EAAE,GAAG,EAAE;AACnC,SAAO,CAAC,aAAa,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CACnC,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC,CAC/B,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC,SAClB,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;CAC1B,CAAC;;AAEF,OAAO,CAAC,cAAc,GAAG,UAAS,GAAG,EAAE,GAAG,EAAE;AAC1C,SAAO,CAAC,aAAa,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CACnC,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC,CAC/B,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC,SAClB,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;CAC1B,CAAC;;AAEF,OAAO,CAAC,aAAa,GAAG,UAAS,GAAG,EAAE,GAAG,EAAE;AACzC,QAAM,CAAC,aAAa,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CAClC,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC,CAC/B,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC,SAClB,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;CAC1B,CAAC;;;AAGF,OAAO,CAAC,MAAM,GAAG,UAAS,GAAG,EAAE,GAAG,EAAE;AAClC,MAAI,IAAI,GAAG,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC;AAC1B,MAAI,CAAC,IAAI,EAAE;AACT,WAAO,WAAW,CAAC,GAAG,CAAC,CAAC,mBAAmB,CAAC,CAAC;GAC9C;;AAED,SAAO,CAAC,aAAa,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CACnC,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC,CAC/B,IAAI,CAAC,iBAAiB,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC,CAClC,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC,SACxB,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;CAC1B,CAAC;;AAEF,OAAO,CAAC,OAAO,GAAG,UAAS,GAAG,EAAE,GAAG,EAAE;AACnC,SAAO,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC;AAC9B,SAAO,CAAC,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;AACtB,MAAI,KAAK,GAAG,GAAG,CAAC,MAAM,CAAC,KAAK,CAAC;AAC7B,MAAI,IAAI,GAAG,GAAG,CAAC,MAAM,CAAC,IAAI,IAAI,CAAC,CAAC;AAChC,SAAO,CACN,OAAO,CAAC;AACP,QAAI,EAAE,GAAG,CAAC,MAAM,CAAC,IAAI;GACtB,CAAC,CACD,SAAS,EAAE,CACX,IAAI,CAAC,kBAAkB,CAAC,KAAK,EAAC,IAAI,CAAC,CAAC,CACpC,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC,SACxB,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;CAC1B,CAAC;;AAEF,OAAO,CAAC,MAAM,GAAG,UAAS,GAAG,EAAE,GAAG,EAAE;AAClC,MAAI,IAAI,GAAG,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC;AAC3B,SAAO,CACN,OAAO,CAAC;AACP,QAAI,EAAE,GAAG,CAAC,MAAM,CAAC,IAAI;GACtB,CAAC,CACD,SAAS,EAAE,CACX,IAAI,CAAC,wBAAwB,CAAC,IAAI,CAAC,CAAC,CACpC,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC,SACxB,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;CAC1B,CAAC;;;AAGF,SAAS,gBAAgB,CAAC,GAAG,EAAE,GAAG,EAAE,SAAS,EAAE;AAC7C,SAAO,UAAS,MAAM,EAAE;AACtB,QAAI,KAAK,GAAG,MAAM,CAAC;AACnB,WAAO,OAAO,CAAC,aAAa,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CAC1C,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC,CAC/B,IAAI,CAAC,UAAS,MAAM,EAAE;AACrB,YAAM,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;AAC9B,aAAO,MAAM,CAAC,SAAS,EAAE,CAAC,MAAM,CAAC,YAAW;AAC1C,eAAO,KAAK,CAAC;OACd,CAAC,CAAC;KACJ,CAAC,CAAA;GACH,CAAA;CACF;;AAED,SAAS,SAAS,CAAC,GAAG,EAAE;AACtB,SAAO,UAAS,MAAM,EAAE;AACtB,QAAI,MAAM,EAAE;AACV,UAAI,MAAM,GAAG,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,MAAM,EAAE,UAAS,OAAO,EAAE;AAClD,eAAO,KAAK,CAAC,aAAa,CAAC,OAAO,CAAC,CAClC,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC,CAAC;OAClC,CAAC,CAAA;AACF,aAAO,SAAQ,GAAG,CAAC,MAAM,CAAC,CAAC;KAC5B,MAAM;AACL,aAAO,IAAI,CAAC;KACb;GACF,CAAA;CACF;;AAED,SAAS,gBAAgB,CAAC,IAAI,EAAE;AAC9B,SAAO,UAAS,MAAM,EAAE;AACtB,QAAI,OAAO,GAAG,kBAAkB,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AAC5D,QAAI,OAAO,GAAG,CAAC,CAAC,KAAK,CAAC,MAAM,EAAE;AAC5B,cAAQ,EAAE,OAAO;KAClB,CAAC,CAAC;;AAEH,WAAO,OAAO,CAAC,SAAS,EAAE,CACzB,MAAM,CAAC,UAAS,OAAO,EAAE;AACxB,aAAO,OAAO,CAAC;KAChB,CAAC,CAAC;GACJ,CAAC;CACH;;;AAGD,OAAO,CAAC,WAAW,GAAG,UAAS,GAAG,EAAE,GAAG,EAAE;AACvC,MAAI,IAAI,GAAG,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC;AAC1B,MAAI,CAAC,IAAI,EAAE;AACT,WAAO,WAAW,CAAC,GAAG,CAAC,CAAC,mBAAmB,CAAC,CAAC;GAC9C;;AAED,MAAI,OAAO,GAAG,kBAAkB,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;;AAE5D,OAAK,CAAC,WAAW,CAAC;AAChB,YAAQ,EAAE,OAAO;GAClB,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC,CACjD,IAAI,CAAC,kBAAkB,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC,SAC7B,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;CAC1B,CAAC;;;AAGF,OAAO,CAAC,UAAU,GAAG,UAAS,GAAG,EAAE,GAAG,EAAE;AACtC,SAAO,CAAC,aAAa,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CACnC,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC,CAC/B,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,CACpB,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC,SACxB,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;CAC1B,CAAC;;;AAGF,OAAO,CAAC,WAAW,GAAG,UAAS,GAAG,EAAE,GAAG,EAAE;AACvC,MAAI,IAAI,GAAG,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC;AAC1B,MAAI,CAAC,IAAI,EAAE;AACT,WAAO,WAAW,CAAC,GAAG,CAAC,CAAC,mBAAmB,CAAC,CAAC;GAC9C;;AAED,OAAK,CAAC,aAAa,CAAC,GAAG,CAAC,MAAM,CAAC,QAAQ,CAAC,CACvC,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC,CAC/B,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC,CAC5B,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC,SACxB,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;CAC1B,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqFF,SAAS,UAAU,CAAC,GAAG,EAAE;AACvB,SAAO,UAAS,MAAM,EAAE;AACtB,QAAI,MAAM,EAAE;AACV,UAAI,OAAO,GAAG,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,OAAO,EAAE,UAAS,QAAQ,EAAE;AACrD,eAAO,MAAM,CAAC,aAAa,CAAC,QAAQ,CAAC,CACpC,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC,CAAC;OAClC,CAAC,CAAA;AACF,aAAO,SAAQ,GAAG,CAAC,OAAO,CAAC,CAAC;KAC7B,MAAM;AACL,aAAO,IAAI,CAAC;KACb;GACF,CAAA;CACF;;AAED,SAAS,iBAAiB,CAAC,GAAG,EAAE,SAAS,EAAE;AACzC,SAAO,UAAS,MAAM,EAAE;AACtB,QAAI,MAAM,GAAG,MAAM,CAAC;AACpB,WAAO,OAAO,CAAC,aAAa,CAAC,SAAS,CAAC,CACtC,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC,CAC/B,IAAI,CAAC,UAAS,MAAM,EAAE;AACrB,YAAM,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AAChC,aAAO,MAAM,CAAC,SAAS,EAAE,CAAC,MAAM,CAAC,YAAW;AAC1C,eAAO,MAAM,CAAC;OACf,CAAC,CAAC;KACJ,CAAC,CAAA;GACH,CAAA;CACF;;AAED,SAAS,cAAc,CAAC,QAAQ,EAAE,MAAM,EAAE;AACxC,SAAO,UAAS,MAAM,EAAE;AACtB,QAAI,WAAW,GAAG,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;AACnD,UAAM,CAAC,OAAO,CAAC,MAAM,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC;AACtC,WAAO,MAAM,CAAC,SAAS,EAAE,CACxB,IAAI,CAAC,YAAW;AACf,aAAO,MAAM,CAAC;KACf,CAAC,CAAC;GACJ,CAAC;CACH;;AAED,OAAO,CAAC,YAAY,GAAG,UAAS,GAAG,EAAE,GAAG,EAAE;AACxC,QAAM,CAAC,WAAW,CAAC,GAAG,CAAC,IAAI,CAAC,CAC3B,IAAI,CAAC,iBAAiB,CAAC,GAAG,EAAE,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC,CAC3C,IAAI,CAAC,kBAAkB,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC,SAC7B,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;CAC1B,CAAA;;;AAGD,OAAO,CAAC,WAAW,GAAG,UAAS,GAAG,EAAE,GAAG,EAAE;AACvC,SAAO,CAAC,aAAa,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CACnC,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC,CAC/B,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC,CACrB,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC,SACxB,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;CAC1B,CAAC;;AAEF,OAAO,CAAC,YAAY,GAAG,UAAS,GAAG,EAAE,GAAG,EAAE;AACxC,MAAI,GAAG,CAAC,IAAI,CAAC,GAAG,EAAE;AAChB,WAAO,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC;GACrB;AACD,QAAM,CAAC,aAAa,CAAC,GAAG,CAAC,MAAM,CAAC,SAAS,CAAC,CACzC,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC,CAC/B,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAC3B,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC,SACxB,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;CAC1B,CAAC;;;AAGF,OAAO,CAAC,aAAa,GAAG,UAAS,GAAG,EAAE,GAAG,EAAE;;AAEzC,QAAM,CAAC,aAAa,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CAClC,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC,CAC/B,IAAI,CAAC,UAAS,MAAM,EAAE;AACrB,QAAI,MAAM,GAAG,MAAM,CAAC;AACpB,WAAO,OAAO,CAAC,aAAa,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CAC1C,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC,CAC/B,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,MAAM,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC,CAAC;GACrD,CAAC,CACD,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC,SAClB,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;CAC1B,CAAC","file":"product.controller.js","sourcesContent":["/**\n * Using Rails-like standard naming convention for endpoints.\n * GET     /api/products              ->  index\n * POST    /api/products              ->  create\n * GET     /api/products/:id          ->  show\n * PUT     /api/products/:id          ->  update\n * DELETE  /api/products/:id          ->  destroy\n */\n\n 'use strict';\n\n var _ = require('lodash');\n\n\n var Product = require('./product.model').product;\n var Image = require('./product.model').image;\n var Review = require('./product.model').review;\n var Feature = require('./product.model').feature;\n var Filter = require('./product.model').filter;\n var Catalog = require('../catalog/catalog.model');\n var path = require('path');\n\n\n\n function handleError(res, statusCode) {\n  statusCode = statusCode || 500;\n  return function(err) {\n    console.error(err, statusCode);\n    res.status(statusCode).send(err);\n  };\n}\n\nfunction isJson(str) {\n  try {\n    str = JSON.parse(str);\n  } catch (e) {\n    str = str;\n  }\n  return str\n}\n\nfunction responseWithResult(res, statusCode) {\n\n\n  statusCode = statusCode || 200;\n  return function(entity) {\n    if (entity) {\n      res.status(statusCode).json(entity);\n    }\n  };\n}\n\nfunction handleEntityNotFound(res) {\n  return function(entity) {\n    if (!entity) {\n      res.status(404).end();\n      return null;\n    }\n    return entity;\n  };\n}\n\nfunction saveUpdates(updates) {\n  return function(entity) {\n    var updated = _.merge(entity, updates);\n    return updated.saveAsync()\n    .spread(function(updated) {\n      return updated;\n    });\n  };\n}\n\nfunction removeEntity(res) {\n  return function(entity) {\n    if (entity) {\n      return entity.removeAsync()\n      .then(function() {\n        res.status(204).end();\n      });\n    }\n  };\n}\n\nfunction saveFeaturedImage(res, file) {\n  return function(entity) {\n    var newPath = '/assets/uploads/' + path.basename(file.path);\n    entity.imageUrl = newPath;\n    return entity.saveAsync().spread(function(updated) {\n      return updated;\n    });\n  }\n}\n\nfunction productsInCategory(limit,page) {\n  limit = Number(limit) || null;\n  return function(catalog) {\n    var catalog_ids = [catalog._id].concat(catalog.children);\n    console.log(catalog_ids);\n    return Product\n    .find({\n      'categories': {\n        $in: catalog_ids\n      }\n    })\n    .skip(page*limit)\n    .limit(limit)\n    .sort({title: 'asc'})\n    .populate({ path: 'categories', select: 'name' })\n    .populate({ path: 'reviews', select: 'rating' })\n    .populate({ path: 'images', select: 'imageUrl' })\n    .populate({ path: 'feature ', select: 'name' })\n    .execAsync();\n  }\n}\n\nfunction productsInSearchCategory(term) {\n  return function(catalog) {\n    var catalog_ids = [catalog._id].concat(catalog.children);\n    var option;\n\n    if (catalog.slug == 'all')\n      option = {\n        $text: {\n          $search: term\n        }\n      };\n      else\n        option = {\n          'categories': {\n            $in: catalog_ids\n          },\n          $text: {\n            $search: term\n          }\n        };\n\n        return Product\n        .find(option)\n        .populate({ path: 'categories', select: 'name' })\n        .populate({ path: 'reviews', select: 'rating' })\n        .populate({ path: 'images', select: 'imageUrl' })\n        .execAsync();\n      }\n    }\n\n// Gets a list of Products\nexports.index = function(req, res) {\n  if(req.query){\n    var q = isJson(req.query.where);\n    var limit = parseInt(req.query.list);\n    var skip = parseInt(req.query.skip)\n\n    console.log(limit);\n    Product.find(q).limit(limit).skip(skip).populate({ path: \"categories\", select: \"name\" }).execAsync()\n    .then(responseWithResult(res))\n    .catch(handleError(res));\n\n  }else{\n    Product.find().sort({ featured: 1 }).populate({ path: \"categories\", select: \"name\" }).execAsync()\n    .then(responseWithResult(res))\n    .catch(handleError(res));\n  }\n};\n\n\nexports.catalogindex = function(req, res){\n if(req.query){\n  console.log(req.query)\n  var q = isJson(req.query.where);\n  Product.find(q).limit(req.query.limit).skip(req.query.skip).populate({ path: \"categories\", select: \"name\" }).execAsync()\n  .then(responseWithResult(res))\n  .catch(handleError(res));\n\n}\n}\n\nexports.addtofeaturedproducts = function(req,res){\n Product.update({ _id: req.params.id }, { $set: { featured: true }}, function (err, product) {\n  if (err) {\n    responseObject.err = err;\n    responseObject.data = null;\n    responseObject.code = 422;\n\n    return res.json(responseObject);\n  }   \n  Product.find().sort({ featured: 1 }).populate({ path: \"categories\", select: \"name\" }).execAsync()\n  .then(responseWithResult(res))\n  .catch(handleError(res));\n\n});\n}\n\nexports.removefromfeaturedproducts = function(req,res){\n Product.update({ _id: req.params.id }, { $set: { featured: false }}, function (err, product) {\n  if (err) {\n    responseObject.err = err;\n    responseObject.data = null;\n    responseObject.code = 422;\n\n    return res.json(responseObject);\n  }   \n  Product.find().sort({ featured: 1 }).populate({ path: \"categories\", select: \"name\" }).execAsync()\n  .then(responseWithResult(res))\n  .catch(handleError(res));\n  \n});\n}\n\nexports.indexAffiliateProduct = function(req, res){\n  Product.find({affiliate:true}).sort({ stock: 1 }).populate({ path: \"categories\", select: \"name\" }).execAsync()\n  .then(responseWithResult(res))\n  .catch(handleError(res));\n}\n\nexports.indexFeatures = function(req, res) {\n  Feature.find().execAsync()\n  .then(responseWithResult(res))\n  .catch(handleError(res));\n};\n\nexports.indexFilters = function(req, res) {\n  Filter.find().execAsync()\n  .then(responseWithResult(res))\n  .catch(handleError(res));\n};\n\nexports.count = function(req, res) {\n\n  console.log(req.body);\n\n  if(req.body){\n    \n    var q = isJson(req.body.where);\n    console.log(\"q\"+q)\n    \n    Product.find(q).count().exec(function (err, count) {\n      console.log(\"count\" + count);\n      if(err) { \n        console.log(err)\n        return handleError(res, err); }\n        return res.status(200).json([{count:count}]);\n      });\n  }else{\n    Product.count().exec(function (err, count) {\n      if(err) { \n        console.log(err)\n        return handleError(res, err); }\n        return res.status(200).json([{count:count}]);\n      });\n  }\n};\n// Gets a single Product from the DB\nexports.show = function(req, res) {\n  Product.findOne({\n    slug: req.params.slug\n  })\n  .populate('images')\n  .populate({ path: 'reviews' }).populate({ path: 'categories', select: 'slug' })\n  .execAsync()\n  .then(handleEntityNotFound(res))\n  .then(function(entity) {\n    if (entity) {\n      res.status(200).json(entity);\n    }\n  })\n  .catch(handleError(res));\n};\n\n// Creates a new Product in the DB\nexports.create = function(req, res) {\n  Product.createAsync(req.body)\n  .then(responseWithResult(res, 201))\n  .catch(handleError(res));\n};\n\nexports.createFeature = function(req, res) {\n  console.log(\"inside create feature\");\n  console.log(req.body);\n  Feature.createAsync(req.body)\n  .then(responseWithResult(res, 201))\n  .catch(handleError(res));\n};\n\nexports.createFilter = function(req, res) {\n  console.log(\"inside create createFilter\");\n  console.log(req.body);\n  Filter.createAsync(req.body)\n  .then(responseWithResult(res, 201))\n  .catch(handleError(res));\n};\n\n// Updates an existing Product in the DB\nexports.update = function(req, res) {\n  if (req.body._id) {\n    delete req.body._id;\n  }\n  Product.findByIdAsync(req.params.id)\n  .then(handleEntityNotFound(res))\n  .then(saveUpdates(req.body))\n  .then(responseWithResult(res))\n  .catch(handleError(res));\n};\n\nexports.updateFeature = function(req, res) {\n  if (req.body._id) {\n    delete req.body._id;\n  }\n  Feature.findByIdAsync(req.params.id)\n  .then(handleEntityNotFound(res))\n  .then(saveUpdates(req.body))\n  .then(responseWithResult(res))\n  .catch(handleError(res));\n};\n\n// Deletes a Product from the DB\nexports.destroy = function(req, res) {\n  Product.findByIdAsync(req.params.id)\n  .then(handleEntityNotFound(res))\n  .then(removeEntity(res))\n  .catch(handleError(res));\n};\n\nexports.destroyFeature = function(req, res) {\n  Feature.findByIdAsync(req.params.id)\n  .then(handleEntityNotFound(res))\n  .then(removeEntity(res))\n  .catch(handleError(res));\n};\n\nexports.destroyFilter = function(req, res) {\n  Filter.findByIdAsync(req.params.id)\n  .then(handleEntityNotFound(res))\n  .then(removeEntity(res))\n  .catch(handleError(res));\n};\n\n// Uploads a new Product's featured image in the DB\nexports.upload = function(req, res) {\n  var file = req.files.file;\n  if (!file) {\n    return handleError(res)('File not provided');\n  }\n\n  Product.findByIdAsync(req.params.id)\n  .then(handleEntityNotFound(res))\n  .then(saveFeaturedImage(res, file))\n  .then(responseWithResult(res))\n  .catch(handleError(res));\n};\n\nexports.catalog = function(req, res) {\n  console.log(\"inside catalog\");\n  console.log(req.body);\n  var limit = req.params.limit;\n  var page = req.params.page || 0;\n  Catalog\n  .findOne({\n    slug: req.params.slug\n  })\n  .execAsync()\n  .then(productsInCategory(limit,page))\n  .then(responseWithResult(res))\n  .catch(handleError(res));\n};\n\nexports.search = function(req, res) {\n  var term = req.params.term;\n  Catalog\n  .findOne({\n    slug: req.params.slug\n  })\n  .execAsync()\n  .then(productsInSearchCategory(term))\n  .then(responseWithResult(res))\n  .catch(handleError(res));\n};\n\n/*images*/\nfunction linkImageProduct(req, res, productId) {\n  return function(entity) {\n    var image = entity;\n    return Product.findByIdAsync(req.params.id)\n    .then(handleEntityNotFound(res))\n    .then(function(entity) {\n      entity.images.push(image._id);\n      return entity.saveAsync().spread(function() {\n        return image;\n      });\n    })\n  }\n}\n\nfunction getImages(res) {\n  return function(entity) {\n    if (entity) {\n      var images = _.map(entity.images, function(imageId) {\n        return Image.findByIdAsync(imageId)\n        .then(handleEntityNotFound(res));\n      })\n      return Promise.all(images);\n    } else {\n      return null;\n    }\n  }\n}\n\nfunction saveImageUpdates(file) {\n  return function(entity) {\n    var newPath = '/assets/uploads/' + path.basename(file.path);\n    var updated = _.merge(entity, {\n      imageUrl: newPath\n    });\n\n    return updated.saveAsync()\n    .spread(function(updated) {\n      return updated;\n    });\n  };\n}\n\n// Uploads a new Product's other images image in the DB\nexports.uploadImage = function(req, res) {\n  var file = req.files.file;\n  if (!file) {\n    return handleError(res)('File not provided');\n  }\n\n  var newPath = '/assets/uploads/' + path.basename(file.path);\n\n  Image.createAsync({\n    imageUrl: newPath\n  }).then(linkImageProduct(req, res, req.params.id))\n  .then(responseWithResult(res, 201))\n  .catch(handleError(res));\n};\n\n// Gets images for a single Product from the DB\nexports.indexImage = function(req, res) {\n  Product.findByIdAsync(req.params.id)\n  .then(handleEntityNotFound(res))\n  .then(getImages(res))\n  .then(responseWithResult(res))\n  .catch(handleError(res));\n};\n\n// Updates an existing Product image in the DB\nexports.updateImage = function(req, res) {\n  var file = req.files.file;\n  if (!file) {\n    return handleError(res)('File not provided');\n  }\n\n  Image.findByIdAsync(req.params.image_id)\n  .then(handleEntityNotFound(res))\n  .then(saveImageUpdates(file))\n  .then(responseWithResult(res))\n  .catch(handleError(res));\n};\n\n/*Variants*/\n/*function getVariants(res) {\n  return function(entity) {\n    if (entity) {\n      var variants = _.map(entity.variants, function(variantId) {\n        return Variant.findByIdAsync(variantId)\n        .then(handleEntityNotFound(res));\n      })\n      return Promise.all(variants);\n    } else {\n      return null;\n    }\n  }\n}\n\nfunction linkVariantProduct(res, productId) {\n  return function(entity) {\n    var variant = entity;\n    return Product.findByIdAsync(productId)\n    .then(handleEntityNotFound(res))\n    .then(function(entity) {\n      entity.variants.push(variant._id);\n      return entity.saveAsync().spread(function() {\n        return variant;\n      });\n    })\n  }\n}\n\nfunction removeVariantId(variantId, variant) {\n  return function(entity) {\n    var variantIndex = entity.variants.indexOf(variantId);\n    entity.variants.splice(variantIndex, 1);\n    return entity.saveAsync()\n    .then(function() {\n      return variant;\n    });\n  };\n}\n\nexports.createVariant = function(req, res) {\n  Variant.createAsync(req.body)\n  .then(linkVariantProduct(res, req.params.id))\n  .then(responseWithResult(res, 201))\n  .catch(handleError(res));\n}\n\n// Gets variants for a single Product from the DB\nexports.indexVariant = function(req, res) {\n  Product.findByIdAsync(req.params.id)\n  .then(handleEntityNotFound(res))\n  .then(getVariants(res))\n  .then(responseWithResult(res))\n  .catch(handleError(res));\n};\n// Updates an existing Variant in the DB\nexports.updateVariant = function(req, res) {\n  if (req.body._id) {\n    delete req.body._id;\n  }\n  Variant.findByIdAsync(req.params.variant_id)\n  .then(handleEntityNotFound(res))\n  .then(saveUpdates(req.body))\n  .then(responseWithResult(res))\n  .catch(handleError(res));\n};\n\n// Deletes a variant from the DB\nexports.destroyVariant = function(req, res) {\n\n  Variant.findByIdAsync(req.params.id)\n  .then(handleEntityNotFound(res))\n  .then(function(entity) {\n    var variant = entity;\n    return Product.findByIdAsync(req.params.id)\n    .then(handleEntityNotFound(res))\n    .then(removeVariantId(req.params.variant_id, variant));\n  })\n  .then(removeEntity(res))\n  .catch(handleError(res));\n};*/\n\n/*Reviews*/\nfunction getReviews(res) {\n  return function(entity) {\n    if (entity) {\n      var reviews = _.map(entity.reviews, function(reviewId) {\n        return Review.findByIdAsync(reviewId)\n        .then(handleEntityNotFound(res));\n      })\n      return Promise.all(reviews);\n    } else {\n      return null;\n    }\n  }\n}\n\nfunction linkReviewProduct(res, productId) {\n  return function(entity) {\n    var review = entity;\n    return Product.findByIdAsync(productId)\n    .then(handleEntityNotFound(res))\n    .then(function(entity) {\n      entity.reviews.push(review._id);\n      return entity.saveAsync().spread(function() {\n        return review;\n      });\n    })\n  }\n}\n\nfunction removeReviewId(reviewId, review) {\n  return function(entity) {\n    var reviewIndex = entity.reviews.indexOf(reviewId);\n    entity.reviews.splice(reviewIndex, 1);\n    return entity.saveAsync()\n    .then(function() {\n      return review;\n    });\n  };\n}\n\nexports.createReview = function(req, res) {\n  Review.createAsync(req.body)\n  .then(linkReviewProduct(res, req.params.id))\n  .then(responseWithResult(res, 201))\n  .catch(handleError(res));\n}\n\n// Gets reviews for a single Product from the DB\nexports.indexReview = function(req, res) {\n  Product.findByIdAsync(req.params.id)\n  .then(handleEntityNotFound(res))\n  .then(getReviews(res))\n  .then(responseWithResult(res))\n  .catch(handleError(res));\n};\n// Updates an existing Variant in the DB\nexports.updateReview = function(req, res) {\n  if (req.body._id) {\n    delete req.body._id;\n  }\n  Review.findByIdAsync(req.params.review_id)\n  .then(handleEntityNotFound(res))\n  .then(saveUpdates(req.body))\n  .then(responseWithResult(res))\n  .catch(handleError(res));\n};\n\n// Deletes a variant from the DB\nexports.destroyReview = function(req, res) {\n\n  Review.findByIdAsync(req.params.id)\n  .then(handleEntityNotFound(res))\n  .then(function(entity) {\n    var review = entity;\n    return Product.findByIdAsync(req.params.id)\n    .then(handleEntityNotFound(res))\n    .then(removeReviewId(req.params.review_id, review));\n  })\n  .then(removeEntity(res))\n  .catch(handleError(res));\n};\n"]}