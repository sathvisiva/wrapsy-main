{"version":3,"sources":["../../../client/app/giftcard/giftcard.controller.js"],"names":[],"mappings":"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","file":"giftcard.controller.js","sourcesContent":["'use strict';\n\nangular.module('bhcmartApp')\n.controller('giftcardCtrl', ['$scope', '$state', 'Vendor', '$stateParams','Auth','Voucher','Payment',\n\tfunction($scope, $state, Vendor, $stateParams,Auth,Voucher,Payment) {\n\t\tthis.getCurrentUser = Auth.getCurrentUser;\n\t\tconsole.log(window.location.origin);\n\t\tfunction makeid() {\n\t\t\tvar text = \"\";\n\t\t\tvar possible = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n\n\t\t\tfor (var i = 0; i < 5; i++)\n\t\t\t\ttext += possible.charAt(Math.floor(Math.random() * possible.length));\n\n\t\t\treturn text;\n\t\t}\n\n\n\t\tfunction uuidv4() {\n\t\t\treturn 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n\t\t\t\tvar r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n\t\t\t\treturn v.toString(16);\n\t\t\t});\n\t\t}\n\n\t\t$scope.message = 'Get ready to buy gift card';\n\t\t$scope.mkey = 'gtKFFx';\n\t\t$scope.productInfo = 'AddVoucher';\n\t\t$scope.txnid = makeid();\n\t\t$scope.id = uuidv4();\n\t\t$scope.type = '2';\n\t\t$scope.email = Auth.getCurrentUser().email;\n\t\t$scope.phone = 9176464641;\n\t\t$scope.lastName = this.getCurrentUser().name;\n\t\t$scope.firstName = '';\n\t\t$scope.surl = window.location.origin + \"/api/payment/giftSuccessPaymentStatus\";\n\t\t$scope.furl = window.location.origin + \"/api/payment/giftFilurePaymentStatus\";\n\t\t$scope.hash = '';\n\n\t\t$scope.presubmit = function () {\n\t\t\tvar data = { preHashString: $scope.mkey + '|' + $scope.txnid + '|' + $scope.amount + '|' + $scope.productInfo + '|' + $scope.firstName + '|' + $scope.email + '|' + $scope.id + '||||||||||' };\n\t\t\tPayment.createHash(data, function(resp) {\n\t\t\t\tdocument.getElementById('hash').value = resp.hash;\n\t\t\t\tdocument.getElementById('paymentForm').submit();\n\t\t\t}, function(err) {\n\t\t\t\tconsole.log(err)\n\t\t\t})\n\t\t}\n\n\t\t$scope.save = function(amount){\n\t\t\tconsole.log(amount)\n\t\t\t$scope.voucher = {};\n\t\t\t$scope.user = Auth.getCurrentUser() || {};\n\t\t\t$scope.voucher.validuntil = new Date();\n\t\t\t$scope.voucher.validuntil.setYear($scope.voucher.validuntil.getFullYear() + 1);\n\t\t\t$scope.voucher.email = $scope.user.email;\n\t\t\t$scope.voucher.amount = parseInt(amount);\n\t\t\tconsole.log($scope.voucher);\n\t\t\tVoucher.save($scope.voucher, function(resp) {\n\t\t\t\t$scope.amount = resp.amount;\n\t\t\t\t$scope.productInfo = resp._id;\n\t\t\t\t$scope.presubmit()\n\t\t\t}, function(err) {\n\t\t\t\tconsole.log(err)\n\t\t\t})\n\t/*\t\tconsole.log(\"inside voucher\")\n\t\t\t$scope.voucherFormSubmitted = false;\n\t\t\tif (!form.$valid) {\n\t\t\t\t$scope.voucherFormSubmitted = true\n\t\t\t}else{\n\t\t\t\tif($scope.isLoggedIn()){\n\t\t\t\t\tconsole.log($scope.voucher);\n\t\t\t\t\t$scope.user = Auth.getCurrentUser() || {};\n\t\t\t\t\t$scope.voucher.validuntil = new Date();\n\t\t\t\t\t$scope.voucher.validuntil.setYear($scope.voucher.validuntil.getFullYear() + 1);\n\t\t\t\t\t$scope.voucher.email = $scope.user.email;\n\t\t\t\t\tconsole.log($scope.voucher);\n\t\t\t\t\tVoucher.save($scope.voucher, function(resp) {\n\t\t\t\t\t\t$scope.amount = resp.amount;\n\t\t\t\t\t\t$scope.productInfo = resp._id;\n\t\t\t\t\t\t$scope.presubmit()\n\t\t\t\t\t}, function(err) {\n\t\t\t\t\t\tconsole.log(err)\n\t\t\t\t\t})\n\t\t\t\t}else{\n\t\t\t\t\t$scope.data = {'event' : 'login'};\n\t\t\t\t\t$scope.login(ev, $scope.data);\n\t\t\t\t}\n\t\t\t}*/\n\t\t}\n\n\t}\n\t])\n\nangular.module('bhcmartApp')\n.controller('VoucherListCtrl', function ($scope,$mdDialog,$mdMedia,Auth,Voucher,$http,Payment) {\n\n\tthis.getCurrentUser = Auth.getCurrentUser;\n\tconsole.log(this.getCurrentUser());\n\n\tvar q = {where:{email:Auth.getCurrentUser().email, paid : true }};\n\t$scope.vouchers =  Voucher.query(q);\n\tconsole.log($scope.vouchers)\n\n\t\n});\nangular.module('bhcmartApp')\n.controller('VoucherRedeemCtrl',function ($scope,$rootScope,$state, $stateParams,Registry,Auth,$location, $uibModalInstance, Voucher,amount) {\n\n\n\t$scope.cancel = function () {\n\t\t$uibModalInstance.dismiss('Close');\n\t};\n\t$scope.ok = function () {\n\t\t$scope.errormessage = '';\n\t\t$scope.voucher = {};\n\t\t$scope.voucher.code = $scope.voucherCode;\n\t\t$scope.voucher.amount = amount;\n\t\tVoucher.redeem($scope.voucher, function(resp){\n\t\t\tif(resp.errorcode == 0 ){\n\t\t\t\t$scope.errormessage = \"Sorry, Voucher already redeemed\";\n\t\t\t}else if(resp.errorcode == 1){\n\t\t\t\t$scope.errormessage = \"Sorry, Voucher validity expired\";\n\t\t\t}else if(resp.errorcode == 2){\n\t\t\t\t$scope.errormessage = \"Sorry, Voucher amount is greater than cart amount\";\n\t\t\t}else if(resp.errorcode == 3){\n\t\t\t\t$scope.errormessage = \"Sorry, Invalid voucher code\";\n\t\t\t}\n\t\t\telse{\n\t\t\t\t/*console.log(resp);\n\t\t\t\t$scope.voucher.code = resp.code;\n\t\t\t\t$scope.voucher.amount = resp.amount;\n\t\t\t\t$scope.voucher.id _ resp._id*/\n\n\t\t\t\t$uibModalInstance.close(resp);\t\n\t\t\t}\n\t\t});\n\t\t\n\t};\n\n});\n"]}