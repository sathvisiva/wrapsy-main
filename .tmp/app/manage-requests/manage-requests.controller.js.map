{"version":3,"sources":["../../../client/app/manage-requests/manage-requests.controller.js"],"names":[],"mappings":"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","file":"manage-requests.controller.js","sourcesContent":["'use strict';\n\nangular.module('bhcmartApp')\n  .controller('ManageRequestsCtrl', ['$scope', 'Modal', 'Request', 'Auth', function($scope, Modal, Request, Auth) {\n    let user = Auth.getCurrentUser();\n    $scope.isAdmin = Auth.hasRole('admin');\n    $scope.requests = [];\n\n    if ($scope.isAdmin)\n      Request.query(function(requests) {\n        $scope.requests = requests\n          // pagination controls\n        $scope.currentPage = 1;\n        $scope.totalItems = $scope.requests.length;\n        $scope.itemsPerPage = 10; // items per page\n        $scope.noOfPages = Math.ceil($scope.totalItems / $scope.itemsPerPage);\n      });\n    else\n      Request.myRequests({ id: user._id }, function(requests) {\n        $scope.requests = requests\n          // pagination controls\n        $scope.currentPage = 1;\n        $scope.totalItems = $scope.requests.length;\n        $scope.itemsPerPage = 10; // items per page\n        $scope.noOfPages = Math.ceil($scope.totalItems / $scope.itemsPerPage);\n      });\n\n    $scope.deleteRequest = Modal.confirm.delete(function(o) {\n      o.$remove(o._id, function(resp) {\n        console.log(resp)\n        $scope.requests.splice($scope.requests.indexOf(o), 1);\n      })\n    });\n\n    $scope.deliverRequest = Modal.confirm.process(function(o) {\n      o.processed = o.processed ? false : true;\n      o.$update(function(resp) {\n        console.log(resp)\n      })\n    });\n  }])\n  .controller('SubmitRequestCtrl', ['$scope', 'Modal', 'Request', 'Auth', '$state',\n    function($scope, Modal, Request, Auth, $state) {\n\n      $scope.items = [], $scope.listSubTotal = 0, $scope.listCharge = 0, $scope.listTotal = 0;\n\n      $scope.user = Auth.getCurrentUser() || {};\n      $scope.isLoggedIn = Auth.isLoggedIn();\n      $scope.errors = {};\n      $scope.submitted = false;\n\n      $scope.login = (form) => {\n        $scope.submitted = true;\n\n        if (form.$valid) {\n          Auth.login({\n              email: $scope.user.email,\n              password: $scope.user.password\n            })\n            .then(() => {\n              $state.reload();\n            })\n            .catch(err => {\n              $scope.errors.other = err.message;\n            });\n        }\n      }\n\n      $scope.validate = form => {\n        $scope.submitted = true;\n        if (form.$valid) {\n          $scope.message = '';\n          $scope.success = 'Form is valid. Continue with the section below';\n        }\n      }\n\n\n      $scope.addToList = function(newItem) {\n        $scope.message = null;\n        if (_.size(newItem) < 3) {\n          $scope.message = 'Please, fill the empty fields';\n          return;\n        }\n        newItem.total = newItem.price * newItem.quantity;\n        $scope.items.push(newItem);\n\n        $scope.listSubTotal = _.reduce($scope.items, (a, b) => a + b.total, 0);\n        $scope.listCharge = 0.10 * $scope.listSubTotal;\n        $scope.listTotal = $scope.listSubTotal + $scope.listCharge;\n        $scope.newItem = {};\n      }\n\n\n\n      $scope.removeFromList = function(index) {\n        $scope.items.splice(index, 1);\n      }\n\n      $scope.submitList = (items, user) => {\n        if (user.name && user.email && user.phone && user.address && user.city && user.country) {\n          let list = {};\n          list.items = items;\n          \n          list.listSubTotal = $scope.listSubTotal;\n          list.listCharge = $scope.listCharge;\n          list.listTotal = $scope.listTotal;\n\n          list = _.extend(list, {\n            customerId: user._id ? user._id : '',\n            customerName: user.name,\n            customerEmail: user.email,\n            customerAddress: user.address,\n            customerPhone: user.phone,\n            customerCity: user.city,\n            customerState: user.state ? user.state : '',\n            customerCountry: user.country\n          });\n\n          console.log(list)\n\n          Request.save(list,\n            function(resp) {\n              console.log(resp)\n              $state.go('view-request', { id: resp._id });\n            },\n            function(err) {\n              console.log(err)\n            });\n        } else {\n          $scope.message = 'Please, complete the shipping section and click on validate'\n        }\n      }\n    }\n  ]).controller('ViewRequestCtrl', ['$scope', 'Request', '$stateParams', function($scope, Request, $stateParams) {\n    $scope.request = Request.get({ id: $stateParams.id });\n  }]);;\n"]}