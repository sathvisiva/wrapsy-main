{"version":3,"sources":["../../../client/app/voucher/voucher.controller.js"],"names":[],"mappings":"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","file":"voucher.controller.js","sourcesContent":["'use strict';\n\nangular.module('bhcmartApp')\n.controller('VoucherCtrl', function ($scope,$mdDialog,$mdMedia,Auth,Voucher,$http,Payment) {\n\n\tthis.getCurrentUser = Auth.getCurrentUser;\n\n\tconsole.log(this.getCurrentUser());\n\n\n\tfunction makeid() {\n\t\tvar text = \"\";\n\t\tvar possible = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n\n\t\tfor (var i = 0; i < 5; i++)\n\t\t\ttext += possible.charAt(Math.floor(Math.random() * possible.length));\n\n\t\treturn text;\n\t}\n\n\n\tfunction uuidv4() {\n\t\treturn 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n\t\t\tvar r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n\t\t\treturn v.toString(16);\n\t\t});\n\t}\n\n\t$scope.message = 'Everyone come and see how good I look!';\n\t$scope.mkey = 'gtKFFx';\n\t$scope.productInfo = 'AddVoucher';\n\t$scope.txnid = makeid();\n\t$scope.id = uuidv4();\n\t$scope.type = '2';\n\t$scope.email = 'sathvisiva@gmail.com';\n\t$scope.phone = 9176464641;\n\t$scope.lastName = this.getCurrentUser().name;\n\t$scope.firstName = '';\n\t$scope.surl = \"http://localhost:9000/PaymentStatus\";\n\t$scope.hash = '';\n\n\t$scope.presubmit = function () {\n\t\tvar data = { preHashString: $scope.mkey + '|' + $scope.txnid + '|' + $scope.amount + '|' + $scope.productInfo + '|' + $scope.firstName + '|' + $scope.email + '|' + $scope.id + '||||||||||' };\n\t\tPayment.createHash(data, function(resp) {\n\t\t\tdocument.getElementById('hash').value = resp.hash;\n\t\t\tdocument.getElementById('paymentForm').submit();\n\t\t}, function(err) {\n\t\t\tconsole.log(err)\n\t\t})\n\t}\n\n\n\t$scope.savevoucher = function(ev,form){\n\t\tconsole.log(\"inside voucher\")\n\t\t$scope.voucherFormSubmitted = false;\n\t\tif (!form.$valid) {\n\t\t\t$scope.voucherFormSubmitted = true\n\t\t}else{\n\t\t\tif($scope.isLoggedIn()){\n\t\t\t\tconsole.log($scope.voucher);\n\t\t\t\t$scope.user = Auth.getCurrentUser() || {};\n\t\t\t\t$scope.voucher.validuntil = new Date();\n\t\t\t\t$scope.voucher.validuntil.setYear($scope.voucher.validuntil.getFullYear() + 1);\n\t\t\t\t$scope.voucher.email = $scope.user.email;\n\t\t\t\tconsole.log($scope.voucher);\n\t\t\t\tVoucher.save($scope.voucher, function(resp) {\n\t\t\t\t\t$scope.amount = resp.amount;\n\t\t\t\t\t$scope.productInfo = resp._id;\n\t\t\t\t\t$scope.presubmit()\n\t\t\t\t}, function(err) {\n\t\t\t\t\tconsole.log(err)\n\t\t\t\t})\n\t\t\t}else{\n\t\t\t\t$scope.data = {'event' : 'login'};\n\t\t\t\t$scope.login(ev, $scope.data);\n\t\t\t}\n\t\t}\n\t}\n\n\t$scope.login = function(ev,data) {\n\t\t$mdDialog.show({\n\t\t\tcontroller: 'LoginController'\n\t\t\t, templateUrl: 'app/account/login/login.html'\n\t\t\t, parent: angular.element(document.body)\n\t\t\t, targetEvent: ev\n\n\t\t\t, clickOutsideToClose: true\n\t\t\t, locals: {\n\t\t\t\tdataToPass: data\n\t\t\t}\n\t\t});\n\n\t\t$scope.$watch(function () {\n\t\t\treturn $mdMedia('xs') || $mdMedia('sm');\n\t\t}, function (wantsFullScreen) {\n\t\t\t$scope.customFullscreen = (wantsFullScreen === true);\n\t\t});\n\t}\n\n\n\t$scope.redeemVoucher = function(){\n\t\tvar q = {where:{code:$scope.code}};\n\n\t\tVoucher.redeem(q, function(resp){\n\t\t\tconsole.log(resp);\n\t\t});\n\t}\n});\n\n\n\nangular.module('bhcmartApp')\n.controller('VoucherListCtrl', function ($scope,$mdDialog,$mdMedia,Auth,Voucher,$http,Payment) {\n\n\tthis.getCurrentUser = Auth.getCurrentUser;\n\tconsole.log(this.getCurrentUser());\n\n\tvar q = {where:{email:Auth.getCurrentUser().email, paid : true }};\n\t$scope.vouchers =  Voucher.query(q);\n\tconsole.log($scope.vouchers)\n\n\t\n});\nangular.module('bhcmartApp')\n.controller('VoucherRedeemCtrl',function ($scope,$rootScope,$state, $stateParams,Registry,Auth,$location, $uibModalInstance, Voucher,amount) {\n\n\n\t$scope.cancel = function () {\n\t\t$uibModalInstance.dismiss('Close');\n\t};\n\t$scope.ok = function () {\n\t\t$scope.errormessage = '';\n\t\t$scope.voucher = {};\n\t\t$scope.voucher.code = $scope.voucherCode;\n\t\t$scope.voucher.amount = amount;\n\t\tVoucher.redeem($scope.voucher, function(resp){\n\t\t\tif(resp.errorcode == 0 ){\n\t\t\t\t$scope.errormessage = \"Sorry, Voucher already redeemed\";\n\t\t\t}else if(resp.errorcode == 1){\n\t\t\t\t$scope.errormessage = \"Sorry, Voucher validity expired\";\n\t\t\t}else if(resp.errorcode == 2){\n\t\t\t\t$scope.errormessage = \"Sorry, Voucher amount is greater than cart amount\";\n\t\t\t}else if(resp.errorcode == 3){\n\t\t\t\t$scope.errormessage = \"Sorry, Invalid voucher code\";\n\t\t\t}\n\t\t\telse{\n\t\t\t\t/*console.log(resp);\n\t\t\t\t$scope.voucher.code = resp.code;\n\t\t\t\t$scope.voucher.amount = resp.amount;\n\t\t\t\t$scope.voucher.id _ resp._id*/\n\n\t\t\t\t$uibModalInstance.close(resp);\t\n\t\t\t}\n\t\t});\n\t\t\n\t};\n\n});\n"]}