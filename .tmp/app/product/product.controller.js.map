{"version":3,"sources":["../../../client/app/product/product.controller.js"],"names":[],"mappings":"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","file":"product.controller.js","sourcesContent":["'use strict';\n\nangular.module('bhcmartApp')\n.controller('ProductCtrl', ['$scope', '$stateParams', '$state', 'Product', 'Registry','$rootScope','ngCart','Auth','toaster','$mdDialog','$timeout',\n  function($scope, $stateParams, $state, Product, Registry, $rootScope, ngCart,Auth, toaster,$mdDialog, $timeout) {\n\n      //Get product and fetch related products based on category\n      $scope.product = Product.get({ id: $stateParams.id }, function(p) {\n        if(p.color){\n          $scope.colors = p.color;\n          $scope.product.color = $scope.colors[0];\n        }else{\n          $scope.product.color = '';\n        }\n        if(p.size){\n          $scope.sizes = p.size;\n          $scope.product.size =  $scope.sizes[0];\n        }else{\n          $scope.product.size = '';\n        }\n        console.log(p)\n        $scope.qty = 1;\n        $scope.product.averageRating = getAverageRating(p);\n        var q = {};\n        var f = [];\n        f.push({'categories' : { $in: $scope.selectedcategories  } }); \n        q = {f}\n        $scope.products = Product.query(q, function(relatedProducts){\n         $scope.relatedProducts = _.filter(\n          _.map(relatedProducts, relatedProduct =>\n            _.extend(relatedProduct, { averageRating: getAverageRating(relatedProduct) })), rp => rp._id != p._id);\n       });\n      /*  Product.catalog({ id: p.categories.slug, limit: 10, page : 0  }, function(relatedProducts) {\n          $scope.relatedProducts = _.filter(\n            _.map(relatedProducts, relatedProduct =>\n              _.extend(relatedProduct, { averageRating: getAverageRating(relatedProduct) })), rp => rp._id != p._id);\n            });*/\n          });\n\n      if(Auth.isLoggedIn()){\n        var q = {where:{username:Auth.getCurrentUser().email}};\n        $scope.registryOptions =  Registry.query(q);\n      }\n\n      $scope.registry = {}\n      $scope.registry.registryId = \"\";\n\n      $scope.login = function(ev,data) {\n        $mdDialog.show({\n          controller: 'LoginController'\n          , templateUrl: 'app/account/login/login.html'\n          , parent: angular.element(document.body)\n          , targetEvent: ev\n          \n          , clickOutsideToClose: true\n          , locals: {\n            dataToPass: data\n          }\n        });\n\n        $scope.$watch(function () {\n          return $mdMedia('xs') || $mdMedia('sm');\n        }, function (wantsFullScreen) {\n          $scope.customFullscreen = (wantsFullScreen === true);\n        });\n      }\n\n      $scope.addtoRegistry = function(ev,product, qty,registryId){\n\n        $scope.message = '';\n\n\n        if(!Auth.isLoggedIn()){\n         $scope.data = {'event' : 'login'};\n         $scope.login(ev, $scope.data);\n       }else{\n        if($scope.registryOptions && $scope.registryOptions.length <1 || !$scope.registryOptions){\n          /*$scope.message = \"No Registry found. Please create Registry\";*/\n          $state.go('createregistry.registryType');\n        }else if(!registryId){\n          $scope.message = \"Please choose a Registry\";\n        }else if($scope.registry.registryId){\n          $scope.multiple = false;\n          if(product.price > 5000 && !product.affiliate){\n           var confirm = $mdDialog.confirm()\n           .textContent('Would you like to wishlist this item as a solo item or put it under a chip-in category so that multiple guests can chip- in towards it?')\n           .ariaLabel('solo or multichipin')\n           .targetEvent(ev)\n           .ok('Chip In')\n           .cancel('Solo');\n\n           $mdDialog.show(confirm).then(function() {\n            $scope.multiple = true;\n            $scope.addregistrytoDB(product, qty,registryId,$scope.multiple);\n          }, function() {\n           $scope.multiple = false;\n           $scope.addregistrytoDB(product, qty,registryId,$scope.multiple);\n         }); \n\n\n         }else{\n          $scope.addregistrytoDB(product, qty,registryId,$scope.multiple);\n        }\n\n\n      }\n    }\n  }\n\n  $scope.addregistrytoDB = function(product, qty,registryId,multiple){\n   $scope.products = {};\n   $scope.products._id = product._id;\n   $scope.products.name = product.title;\n   $scope.products.slug = product.slug;\n   $scope.products.price = product.price;\n   $scope.products.imageUrl = product.imageUrl;\n   $scope.products.desired = qty;\n   $scope.products.required = 0;\n   $scope.products.prodcode = product.prodcode;\n   $scope.products.linkId = product.linkId;\n   $scope.products.affiliate = product.affiliate;\n   $scope.products.multiple = multiple;\n   $scope.products.color = product.color;\n   $scope.products.size = product.size;\n   if(multiple){\n    $scope.products.price = $scope.products.price * qty;\n  }\n  var q= {};\n  q.where = {};\n  var f =[];\n  f.push({'_id' : registryId});\n  f.push({'products._id': product._id})\n  q.where = { $and : f};\n  Registry.query(q,function(data) {\n    if(data.length==0){\n      Registry.registryProduct({ id: registryId }, $scope.products, function(resp) {\n        toaster.pop('success', \"Product has been added successfully\");\n        $timeout(function() {\n          window.history.back();\n        }, 1000);\n      },function(err) {\n        console.log(err)\n      });\n    }else{\n      toaster.pop('error', \"Sorry, Product is already available in the selected Registry\");\n    }\n  });\n\n\n}\n\n$scope.addtocart = function(product, qty){\n  console.log(product);\n  var gst = parseInt(product.sgst) + parseInt(product.cgst);\n  var gstamount = (parseInt(gst)*parseInt(qty)*parseInt(product.price))/100\n  ngCart.addItem(product._id, product.title, product.price, qty, product,product.color,product.size,gstamount);\n  $state.go('cart');\n\n}\n\n\n$scope.addReview = function(review, productId) {\n  $scope.addrating = false;\n  Product.review({ id: productId }, review, function(resp) {\n    $scope.product.reviews.push(resp);\n    $scope.review = { rating: 5 };\n    $scope.message = \"Review added successfully\"\n  }, function(err) {\n    console.log(err)\n    $scope.message = \"An error occured!\"\n  });\n}\n}\n]);\n\nlet getAverageRating = p => Math.ceil(_.reduce(p.reviews, (a, b) => a + b.rating, 0) / p.reviews.length);\n"]}