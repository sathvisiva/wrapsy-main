{"version":3,"sources":["../../../client/app/product/product.controller.js"],"names":[],"mappings":"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","file":"product.controller.js","sourcesContent":["'use strict';\n\nangular.module('bhcmartApp')\n.controller('ProductCtrl', ['$scope', '$stateParams', '$state', 'Product', 'Registry','$rootScope','RegistryService','Auth','toaster','$timeout',\n  function($scope, $stateParams, $state, Product, Registry, $rootScope, RegistryService,Auth, toaster, $timeout) {\n\n\n  $scope.product = Product.get({ id: $stateParams.id }, function(p) {\n\n    $scope.colors = p.color.split(',');\n    $scope.sizes =  p.size.split(',');\n    $scope.selectedObj = {};\n    $scope.product.averageRating = getAverageRating(p);\n    Product.catalog({ id: p.categories[0].slug, limit: 6 }, function(relatedProducts) {\n      $scope.relatedProducts = _.filter(\n        _.map(relatedProducts, relatedProduct =>\n          _.extend(relatedProduct, { averageRating: getAverageRating(relatedProduct) })), rp => rp._id != p._id);\n    });\n  });\n\n  if(Auth.isLoggedIn()){\n    var q = {where:{username:Auth.getCurrentUser().email}};\n    $scope.registryOptions =  Registry.query(q);\n  }\n\n  $scope.registry = {}\n  $scope.registry.registryId = \"\"\n\n\n\n\n\n  $scope.registryId = RegistryService.getregistry()._id\n\n  $scope.addtoRegistry = function(product, qty,registryId){\n\n    if(!Auth.isLoggedIn()){\n      toaster.pop('error', \"Please login to add Registry\");\n    }else if($scope.registryOptions.length <1){\n      toaster.pop('error', \"No Registry found. Please create Registry\");\n    }else if(!registryId){\n     toaster.pop('error', \"Please choose a Registry\");\n   }else if($scope.registry.registryId){\n\n\n    $scope.products = {}\n    $scope.products._id = product._id\n    $scope.products.name = product.title\n    $scope.products.slug = product.slug\n    $scope.products.price = product.price\n    $scope.products.imageUrl = product.imageUrl\n    $scope.products.desired = qty\n    $scope.products.required = 0\n    $scope.products.prodcode = product.prodcode\n    $scope.products.linkId = product.linkId\n    $scope.products.affiliate = product.affiliate\n\n    var q= {};\n    q.where = {};\n    var f =[];\n    f.push({'_id' : registryId});\n    f.push({'products._id': product._id})\n    q.where = { $and : f};\n    Registry.query(q,function(data) {\n      if(data.length==0){\n        Registry.registryProduct({ id: registryId }, $scope.products, function(resp) {\n          toaster.pop('success', \"Product has been added successfully\");\n          $timeout(function() {\n            window.history.back();\n          }, 1000);\n        },function(err) {\n          console.log(err)\n        });\n      }else{\n        toaster.pop('error', \"Sorry, Product is already available in the selected Registry\");\n      }\n    });\n\n\n\n\n  }\n\n\n\n\n}\n\n\n$scope.addReview = function(review, productId) {\n  Product.review({ id: productId }, review, function(resp) {\n    $scope.product.reviews.push(resp);\n    $scope.review = { rating: 5 };\n    $scope.message = \"Review added successfully\"\n  }, function(err) {\n    console.log(err)\n    $scope.message = \"An error occured!\"\n  });\n}\n}\n]);\n\nlet getAverageRating = p => Math.ceil(_.reduce(p.reviews, (a, b) => a + b.rating, 0) / p.reviews.length);\n"]}