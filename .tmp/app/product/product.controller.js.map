{"version":3,"sources":["../../../client/app/product/product.controller.js"],"names":[],"mappings":"AAAA,YAAY,CAAC;;AAEb,OAAO,CAAC,MAAM,CAAC,YAAY,CAAC,CACzB,UAAU,CAAC,aAAa,EAAE,CAAC,QAAQ,EAAE,cAAc,EAAE,QAAQ,EAAE,SAAS,EAAE,UAAU,EAAC,YAAY,EAAC,iBAAiB,EAAC,MAAM,EACzH,UAAS,MAAM,EAAE,YAAY,EAAE,MAAM,EAAE,OAAO,EAAE,QAAQ,EAAE,UAAU,EAAE,eAAe,EAAC,IAAI,EAAE;;;AAG1F,QAAM,CAAC,OAAO,GAAG,OAAO,CAAC,GAAG,CAAC,EAAE,EAAE,EAAE,YAAY,CAAC,EAAE,EAAE,EAAE,UAAS,CAAC,EAAE;AAChE,UAAM,CAAC,OAAO,CAAC,aAAa,GAAG,gBAAgB,CAAC,CAAC,CAAC,CAAC;AACnD,WAAO,CAAC,OAAO,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,KAAK,EAAE,CAAC,EAAE,EAAE,UAAS,eAAe,EAAE;AAChF,YAAM,CAAC,eAAe,GAAG,CAAC,CAAC,MAAM,CAC/B,CAAC,CAAC,GAAG,CAAC,eAAe,EAAE,UAAA,cAAc;eACnC,CAAC,CAAC,MAAM,CAAC,cAAc,EAAE,EAAE,aAAa,EAAE,gBAAgB,CAAC,cAAc,CAAC,EAAE,CAAC;OAAA,CAAC,EAAE,UAAA,EAAE;eAAI,EAAE,CAAC,GAAG,IAAI,CAAC,CAAC,GAAG;OAAA,CAAC,CAAC;KAC5G,CAAC,CAAC;GACJ,CAAC,CAAC;;AAEH,MAAI,CAAC,GAAG,EAAC,KAAK,EAAC,EAAC,QAAQ,EAAC,IAAI,CAAC,cAAc,EAAE,CAAC,KAAK,EAAC,EAAC,CAAC;;AAE5D,QAAM,CAAC,eAAe,GAAI,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;;AAE5C,QAAM,CAAC,QAAQ,GAAG,EAAE,CAAA;AACpB,QAAM,CAAC,QAAQ,CAAC,UAAU,GAAG,EAAE,CAAA;;AAE9B,QAAM,CAAC,MAAM,GAAG,CACd,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,EAAE,2DAA2D,EAAE,EACpF,EAAE,IAAI,EAAE,SAAS,EAAE,GAAG,EAAE,gEAAgE,EAAE,CAC3F,CAAC;;AAIH,QAAM,CAAC,UAAU,GAAG,eAAe,CAAC,WAAW,EAAE,CAAC,GAAG,CAAA;;AAEhD,QAAM,CAAC,aAAa,GAAG,UAAS,OAAO,EAAE,GAAG,EAAC,UAAU,EAAC;AACpD,UAAM,CAAC,IAAI,GAAG,KAAK,CAAC;;AAE1B,UAAM,CAAC,UAAU,GAAG,UAAS,KAAK,EAAE;AACpC,YAAM,CAAC,IAAI,GAAG,KAAK,CAAC;KACnB,CAAC;AACC,QAAG,CAAC,IAAI,CAAC,UAAU,EAAE,EAAC;AACnB,YAAM,CAAC,EAAE,CAAC,OAAO,CAAC,CAAC;KACpB,MAAK,IAAG,MAAM,CAAC,QAAQ,CAAC,UAAU,EAAC;;AAGlC,YAAM,CAAC,QAAQ,GAAG,EAAE,CAAA;AACpB,YAAM,CAAC,QAAQ,CAAC,GAAG,GAAG,OAAO,CAAC,GAAG,CAAA;AACjC,YAAM,CAAC,QAAQ,CAAC,IAAI,GAAG,OAAO,CAAC,KAAK,CAAA;AACpC,YAAM,CAAC,QAAQ,CAAC,IAAI,GAAG,OAAO,CAAC,IAAI,CAAA;AACnC,YAAM,CAAC,QAAQ,CAAC,KAAK,GAAG,OAAO,CAAC,KAAK,CAAA;AACrC,YAAM,CAAC,QAAQ,CAAC,QAAQ,GAAG,OAAO,CAAC,QAAQ,CAAA;AAC3C,YAAM,CAAC,QAAQ,CAAC,OAAO,GAAG,GAAG,CAAA;AAC7B,YAAM,CAAC,QAAQ,CAAC,QAAQ,GAAG,CAAC,CAAA;;AAE5B,UAAI,CAAC,GAAE,EAAE,CAAC;AACf,OAAC,CAAC,KAAK,GAAG,EAAE,CAAC;AACb,UAAI,CAAC,GAAE,EAAE,CAAC;AACV,YAAM,CAAC,UAAU,GAAI,MAAM,CAAC,QAAQ,CAAC,UAAU,CAAA;AAC9C,aAAO,CAAC,GAAG,CAAC,MAAM,CAAC,UAAU,CAAC,CAAA;AAC/B,OAAC,CAAC,IAAI,CAAC,EAAC,KAAK,EAAG,MAAM,CAAC,UAAU,EAAC,CAAC,CAAC;AACpC,OAAC,CAAC,IAAI,CAAC,EAAC,cAAc,EAAE,OAAO,CAAC,GAAG,EAAC,CAAC,CAAA;AACrC,OAAC,CAAC,KAAK,GAAG,EAAE,IAAI,EAAG,CAAC,EAAC,CAAC;AACtB,cAAQ,CAAC,KAAK,CAAC,CAAC,EAAC,UAAS,IAAI,EAAE;AACjC,YAAG,IAAI,CAAC,MAAM,IAAE,CAAC,EAAC;AAChB,kBAAQ,CAAC,GAAG,CAAC,EAAC,EAAE,EAAC,MAAM,CAAC,UAAU,EAAC,EAAC,UAAS,QAAQ,EAAC;AACpD,oBAAQ,CAAC,eAAe,CAAC,EAAE,EAAE,EAAE,MAAM,CAAC,UAAU,EAAE,EAAE,MAAM,CAAC,QAAQ,EAAE,UAAS,IAAI,EAAE;;AAElF,oBAAM,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC;aACnB,EAAE,UAAS,GAAG,EAAE;AACf,qBAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAA;AAChB,oBAAM,CAAC,OAAO,GAAG,mBAAmB,CAAA;aACrC,CAAC,CAAC;WACN,CAAC,CAAC;SACF,MAAI;AACH,gBAAM,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC;AAClB,iBAAO,CAAC,GAAG,CAAC,uCAAuC,EAAC,OAAO,CAAC,CAAC;SAC9D;OACF,CAAC,CAAC;KAKJ;GAKM,CAAA;;AAGD,QAAM,CAAC,SAAS,GAAG,UAAS,MAAM,EAAE,SAAS,EAAE;AAC7C,WAAO,CAAC,MAAM,CAAC,EAAE,EAAE,EAAE,SAAS,EAAE,EAAE,MAAM,EAAE,UAAS,IAAI,EAAE;AACvD,YAAM,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AAClC,YAAM,CAAC,MAAM,GAAG,EAAE,MAAM,EAAE,CAAC,EAAE,CAAC;AAC9B,YAAM,CAAC,OAAO,GAAG,2BAA2B,CAAA;KAC7C,EAAE,UAAS,GAAG,EAAE;AACf,aAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAA;AAChB,YAAM,CAAC,OAAO,GAAG,mBAAmB,CAAA;KACrC,CAAC,CAAC;GACJ,CAAA;CACF,CACF,CAAC,CAAC;;AAEL,IAAI,gBAAgB,GAAG,SAAnB,gBAAgB,CAAG,CAAC;SAAI,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,OAAO,EAAE,UAAC,CAAC,EAAE,CAAC;WAAK,CAAC,GAAG,CAAC,CAAC,MAAM;GAAA,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC;CAAA,CAAC","file":"product.controller.js","sourcesContent":["'use strict';\n\nangular.module('bhcmartApp')\n  .controller('ProductCtrl', ['$scope', '$stateParams', '$state', 'Product', 'Registry','$rootScope','RegistryService','Auth',\n    function($scope, $stateParams, $state, Product, Registry, $rootScope, RegistryService,Auth) {\n    \n      //Get product and fetch related products based on category\n      $scope.product = Product.get({ id: $stateParams.id }, function(p) {\n        $scope.product.averageRating = getAverageRating(p);\n        Product.catalog({ id: p.categories[0].slug, limit: 6 }, function(relatedProducts) {\n          $scope.relatedProducts = _.filter(\n            _.map(relatedProducts, relatedProduct =>\n              _.extend(relatedProduct, { averageRating: getAverageRating(relatedProduct) })), rp => rp._id != p._id);\n        });\n      });\n\n      var q = {where:{username:Auth.getCurrentUser().email}};\n\n\t$scope.registryOptions =  Registry.query(q);\n\n\t$scope.registry = {}\n\t$scope.registry.registryId = \"\"\n\n  $scope.alerts = [\n    { type: 'danger', msg: 'Oh snap! Change a few things up and try submitting again.' },\n    { type: 'success', msg: 'Well done! You successfully read this important alert message.' }\n  ];\n\n\n\n\t$scope.registryId = RegistryService.getregistry()._id\n\n      $scope.addtoRegistry = function(product, qty,registryId){\n          $scope.show = false;\n\n    $scope.closeAlert = function(index) {\n    $scope.show = false;\n    };\n      \tif(!Auth.isLoggedIn()){\n          $state.go('login');\n        }else if($scope.registry.registryId){\n\n          \t\n          $scope.products = {}\n          $scope.products._id = product._id\n          $scope.products.name = product.title\n          $scope.products.slug = product.slug\n          $scope.products.price = product.price\n          $scope.products.imageUrl = product.imageUrl\n          $scope.products.desired = qty\n          $scope.products.required = 0\n\n          var q= {};\n  \t\t\tq.where = {};\n  \t\t\tvar f =[];\n  \t\t\t$scope.registryId\t=\t\t$scope.registry.registryId\n  \t\t\t\tconsole.log($scope.registryId)\n  \t\t\tf.push({'_id' : $scope.registryId});\n  \t\t\tf.push({'products._id': product._id})\n  \t\t\tq.where = { $and : f};\n  \t\t\tRegistry.query(q,function(data) {\n    if(data.length==0){\n      Registry.get({id:$scope.registryId},function(registry){\n      \t\tRegistry.registryProduct({ id: $scope.registryId }, $scope.products, function(resp) {\n          \n          $state.go('main');\n        }, function(err) {\n          console.log(err)\n          $scope.message = \"An error occured!\"\n        });\n    });\n    }else{\n      $state.go('main');\n      console.log(\"Product already available in Registry\",\"Sorry\");\n    }\n  });\n\n\n\n\n}\n\n\n     \n\n      }\n\n\n      $scope.addReview = function(review, productId) {\n        Product.review({ id: productId }, review, function(resp) {\n          $scope.product.reviews.push(resp);\n          $scope.review = { rating: 5 };\n          $scope.message = \"Review added successfully\"\n        }, function(err) {\n          console.log(err)\n          $scope.message = \"An error occured!\"\n        });\n      }\n    }\n  ]);\n\nlet getAverageRating = p => Math.ceil(_.reduce(p.reviews, (a, b) => a + b.rating, 0) / p.reviews.length);\n"]}