{"version":3,"sources":["../../../client/app/checkout/checkout.controller.js"],"names":[],"mappings":"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","file":"checkout.controller.js","sourcesContent":["'use strict';\n\nangular.module('bhcmartApp')\n  .controller('CheckoutCtrl', ['$scope', 'Auth', '$state', 'Order', 'ngCart', function($scope, Auth, $state, Order, ngCart) {\n\n    $scope.user = Auth.getCurrentUser() || {};\n    $scope.isLoggedIn = Auth.isLoggedIn();\n    $scope.errors = {};\n    $scope.submitted = false;\n\n    $scope.login = (form) => {\n      $scope.submitted = true;\n\n      if (form.$valid) {\n        Auth.login({\n            email: $scope.user.email,\n            password: $scope.user.password\n          })\n          .then(() => {\n            $state.reload();\n          })\n          .catch(err => {\n            $scope.errors.other = err.message;\n          });\n      }\n    }\n\n    $scope.validate = form => {\n      $scope.submitted = true;\n      if (form.$valid) $scope.message = '';\n    }\n\n\n    $scope.checkout = (cart, user) => {\n\n      console.log(cart)\n      if (user.name && user.email && user.phone && user.address && user.city && user.country) {\n        _.map(cart.items, i => {\n          i.productId = i.id;\n          delete i.data;\n          delete i.id;\n          return i;\n        })\n\n        cart = _.extend(cart, {\n          customerId: user._id ? user._id : '',\n          customerName: user.name,\n          customerEmail: user.email,\n          customerAddress: user.address,\n          customerPhone: user.phone,\n          customerCity: user.city,\n          customerState: user.state ? user.state : '',\n          customerCountry: user.country\n        });\n\n        Order.save(cart,\n          function(resp) {\n            ngCart.empty();\n            $state.go('invoice', {id: resp._id});\n          },\n          function(err) {\n            console.log(err)\n          });\n      } else {\n        $scope.message = 'Please, complete the shipping section and click on validate'\n      }\n    }\n  }]);\n"]}