{"version":3,"sources":["../../../client/app/checkout/checkout.controller.js"],"names":[],"mappings":"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","file":"checkout.controller.js","sourcesContent":["'use strict';\n\nangular.module('bhcmartApp')\n.controller('CheckoutCtrl', ['$scope', 'Auth', '$state', 'Order', 'ngCart','toaster','Voucher','Address','Payment','$uibModal', 'stateService',function($scope, Auth, $state, Order, ngCart, toaster,Voucher,Address,Payment, $uibModal, stateService) {\n  $state.go('checkout.shipping')\n  $scope.user = Auth.getCurrentUser() || {};\n  $scope.user.country = \"In\"\n\n  $scope.isLoggedIn = Auth.isLoggedIn();\n  $scope.errors = {};\n  $scope.submitted = false;\n\n  $scope.disableorder = true ; \n  $scope.disablepayment = true;\n  $scope.address = {};\n\n  var q = {where:{email:Auth.getCurrentUser().email}};\n\n  $scope.myTabIndex = 0;\n  console.log(\"tabindex\");\n\n  console.log($scope.myTabIndex);\n /* $scope.vouchers =  Voucher.query(q);\n  console.log($scope.vouchers)\n\n\n  */\n\n  $scope.moveprev = function(){\n   $scope.myTabIndex = 0; \n   \n }\n\n\n $scope.addVoucher = function(ev){\n  if($scope.isLoggedIn()){\n   var modalInstance = $uibModal.open({\n    templateUrl : 'app/voucher/redeem-voucher.html',\n    controller: 'VoucherRedeemCtrl',\n    size :'md',\n    resolve: {\n      amount: function () {\n       return ngCart.totalCost();\n     }\n   }\n })\n   .result.then(function(result) {\n    console.log(result);\n    console.log($scope.productInfo);\n\n\n    Order.updateVoucher({id:$scope.productInfo},result).$promise.then(function(res) {\n     console.log(res.ok);\n   });\n\n\n  /*  Order.countorders(q, function (orders) {\n      $scope.orderscount = orders[0].count;\n      console.log($scope.orderscount);\n    });*/\n  }, function() {\n  // Cancel\n});\n }else{\n  $scope.data = {'event' : 'login'};\n  $scope.login(ev, $scope.data);\n\n}\n}\n\n$scope.moveNext = function(){\n $scope.myTabIndex = $scope.myTabIndex + 1; \n $scope.showshipping = true;\n}\n\n$scope.gotoshipping = function(){\n  console.log(\"inside shipping\")\n  $scope.myTabIndex = 0;\n}\n\n$scope.showshipping = false;\n\n\n$scope.states = stateService.getstates();\n\n\n/*\n  $scope.savelocationmyTabIndex = function(form){\n    $scope.locationformsubmmyTabIndexitted = false;\n    if (!form.$valid) {\n      $scope.locationformsubmitted = true\n    }else{\n      $scope.disablemessage = false;\n      $state.go('createregistry.message');\n    }\n\n  }*/\n\n  $scope.redeemVoucher = function(voucher1){\n    var data = {code:voucher1};\n    Voucher.redeem(data, function(resp) {\n\n    }, function(err) {\n      console.log(err)\n    })\n\n  }\n\n\n  $scope.validate = form => {\n    if(!$scope.isLoggedIn){\n      toaster.pop('error', \"Please login to continue\");\n    }      \n    console.log(\"state\" + $scope.user.state)\n    if (form.$valid && ( $scope.user.state || $scope.user.state != \"\")) {\n      $scope.message = '';\n      $scope.submitted = true;\n    }else{\n      toaster.pop('error', \"Please check the data entered\");\n    }\n  }\n\n\n  function makeid() {\n    var text = \"\";\n    var possible = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n\n    for (var i = 0; i < 5; i++)\n      text += possible.charAt(Math.floor(Math.random() * possible.length));\n\n    return text;\n  }\n\n/*\n  $scope.checkout = (cart, user) => {\n\n\n    if (user.name && user.email && user.phone && user.address && user.city && user.country) {\n      _.map(cart.items, i => {\n        i.productId = i.id;\n        delete i.data;\n        delete i.id;\n        return i;\n      })\n\n      cart = _.extend(cart, {\n        customerId: user._id ? user._id : '',\n        customerName: user.name,\n        customerEmail: $scope.user.email,\n        customerAddress: user.address,\n        customerAddress1: user.address1,\n        customerlandmark : user.landmark,\n        customerPhone: user.phone,\n        customerCity: user.city,\n        customerState: user.state ? user.state : '',\n        customerCountry: 'India'\n      });\n\n      Order.save(cart,\n        function(resp) {\n          ngCart.empty();\n          $state.go('invoice', {id: resp._id});\n        },\n        function(err) {\n          toaster.pop('error', \"Please Try again later\");\n        });\n    } else {\n      $scope.message = 'Please, complete the shipping section and click on continue'\n    }\n  }*/\n\n  $scope.presubmit = function () {\n    var data = { preHashString: $scope.mkey + '|' + $scope.txnid + '|' + $scope.amount + '|' + $scope.productInfo + '|' + $scope.firstName + '|' + $scope.email + '|' + $scope.id + '||||||||||' };\n    Payment.createHash(data, function(resp) {\n      document.getElementById('hash').value = resp.hash;\n      document.getElementById('paymentForm').submit();\n    }, function(err) {\n      console.log(err)\n    })\n  }\n\n  $scope.message = 'Everyone come and see how good I look!';\n  $scope.mkey = 'gtKFFx';\n  $scope.productInfo = 'Verification order';\n  $scope.txnid = makeid();\n  $scope.amount = 234.99;\n  $scope.id = '2222222';\n  $scope.type = '2';\n  $scope.email = 'sathvisiva@gmail.com';\n  $scope.phone = 9176464641;\n  $scope.lastName = 'test';\n  $scope.firstName = 'fname';\n  $scope.surl = \"http://localhost:9000/PaymentStatus\";\n  $scope.hash = '';\n\n  $scope.checkoutorder = function(cart, user){\n\n    if (user.name && user.email ) {\n      _.map(cart.items, i => {\n        i.productId = i.id;\n        delete i.data;\n        delete i.id;\n        return i;\n      })\n\n      Address.save($scope.address, function(resp) {\n        cart = _.extend(cart, {\n          customerId: user._id ? user._id : '',\n          customerName: user.name,\n          customerEmail: $scope.user.email,\n          customerAddress: user.address\n        });\n        console.log(cart)\n        Order.save(cart,function(resp) {\n          $scope.amount = resp.totalCost;\n          $scope.productInfo = resp._id;\n          //$scope.presubmit();\n          $scope.myTabIndex = $scope.myTabIndex + 1; \n          //ngCart.empty();\n\n        },\n        function(err) {\n          toaster.pop('error', \"Please Try again later\");\n        });\n\n      }, function(err) {\n        console.log(err)\n      });\n\n    } else {\n      $scope.message = 'Please, complete the shipping section and click on continue'\n    }\n\n  }\n}]);\n"]}